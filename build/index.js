import*as e from"react";import*as t from"react-conditionally-render";var a={d:(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},r={};a.d(r,{bI:()=>H,fU:()=>u,RB:()=>f,Zk:()=>d,ZP:()=>I,dp:()=>B});const n=(o={default:()=>e.default,useEffect:()=>e.useEffect,useState:()=>e.useState},s={},a.d(s,o),s);var o,s;const c=(e=>{var t={};return a.d(t,e),t})({default:()=>t.default});var i=function(){return i=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)},l=function(e,t){return{message:e,type:t,id:Math.round(Date.now()*Math.random())}},u=function(e,t){return i(i(i({},l(e,"bot")),t),{loading:!0})},d=function(e,t,a){return i(i({},l(e,t)),a)},f=function(e,t){return i(i({},l(e,"user")),t)},m=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];if(e)return e.apply(void 0,t)};function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},g.apply(this,arguments)}const h=({styles:e={},...t})=>n.default.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},t),n.default.createElement("path",{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"})),p=function(e){var t=e.message,a=e.customComponents;return n.default.createElement("div",{className:"react-chatbot-kit-user-chat-message-container"},n.default.createElement(c.default,{condition:!!a.userChatMessage,show:m(a.userChatMessage,{message:t}),elseShow:n.default.createElement("div",{className:"react-chatbot-kit-user-chat-message"},t,n.default.createElement("div",{className:"react-chatbot-kit-user-chat-message-arrow"}))}),n.default.createElement(c.default,{condition:!!a.userAvatar,show:m(a.userAvatar),elseShow:n.default.createElement("div",{className:"react-chatbot-kit-user-avatar"},n.default.createElement("div",{className:"react-chatbot-kit-user-avatar-container"},n.default.createElement(h,{className:"react-chatbot-kit-user-avatar-icon"})))}))},v=function(){return n.default.createElement("div",{className:"react-chatbot-kit-chat-bot-avatar"},n.default.createElement("div",{className:"react-chatbot-kit-chat-bot-avatar-container"},n.default.createElement("p",{className:"react-chatbot-kit-chat-bot-avatar-letter"},"B")))},y=function(){return n.default.createElement("div",{className:"chatbot-loader-container"},n.default.createElement("svg",{id:"dots",width:"50px",height:"21px",viewBox:"0 0 132 58",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("g",{stroke:"none",fill:"none"},n.default.createElement("g",{id:"chatbot-loader",fill:"#fff"},n.default.createElement("circle",{id:"chatbot-loader-dot1",cx:"25",cy:"30",r:"13"}),n.default.createElement("circle",{id:"chatbot-loader-dot2",cx:"65",cy:"30",r:"13"}),n.default.createElement("circle",{id:"chatbot-loader-dot3",cx:"105",cy:"30",r:"13"})))))};var b=function(){return b=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},b.apply(this,arguments)};const w=function(e){var t=e.message,a=e.withAvatar,r=void 0===a||a,o=e.loading,s=e.messages,i=e.customComponents,l=e.setState,u=e.customStyles,d=e.delay,f=e.id,g=(0,n.useState)(!1),h=g[0],p=g[1];(0,n.useEffect)((function(){var e;return function(t,a){var r=750;d&&(r+=d),e=setTimeout((function(){var e=function(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}([],t,!0).map((function(e){return e.id===f?b(b({},e),{loading:!1,delay:void 0}):e}));a((function(t){return b(b({},t),{messages:e})}))}),r)}(s,l),function(){clearTimeout(e)}}),[d,f]),(0,n.useEffect)((function(){d?setTimeout((function(){return p(!0)}),d):p(!0)}),[d]);var w={backgroundColor:""},E={borderRightColor:""};return u&&(w.backgroundColor=u.backgroundColor,E.borderRightColor=u.backgroundColor),n.default.createElement(c.default,{condition:h,show:n.default.createElement("div",{className:"react-chatbot-kit-chat-bot-message-container"},n.default.createElement(c.default,{condition:r,show:n.default.createElement(c.default,{condition:!!(null==i?void 0:i.botAvatar),show:m(null==i?void 0:i.botAvatar),elseShow:n.default.createElement(v,null)})}),n.default.createElement(c.default,{condition:!!(null==i?void 0:i.botChatMessage),show:m(null==i?void 0:i.botChatMessage,{message:t,loader:n.default.createElement(y,null)}),elseShow:n.default.createElement("div",{className:"react-chatbot-kit-chat-bot-message",style:w},n.default.createElement(c.default,{condition:o,show:n.default.createElement(y,null),elseShow:n.default.createElement("span",null,t)}),n.default.createElement(c.default,{condition:r,show:n.default.createElement("div",{className:"react-chatbot-kit-chat-bot-message-arrow",style:E})}))}))})};function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},E.apply(this,arguments)}const P=({styles:e={},...t})=>n.default.createElement("svg",E({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},t),n.default.createElement("path",{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"}));var S=function(){return S=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},S.apply(this,arguments)},k=function(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))};const O=function(e){var t=e.state,a=e.setState,r=e.widgetRegistry,o=e.messageParser,s=e.parse,i=e.customComponents,u=e.actionProvider,d=e.botName,f=e.customStyles,m=e.headerText,g=e.customMessages,h=e.placeholderText,v=e.validator,y=e.disableScrollToBottom,b=e.messageHistory,E=e.actions,O=e.messageContainerRef,C=t.messages,M=(0,n.useState)(""),N=M[0],x=M[1],j=function(){setTimeout((function(){var e;O.current&&(O.current.scrollTop=null===(e=null==O?void 0:O.current)||void 0===e?void 0:e.scrollHeight)}),50)};(0,n.useEffect)((function(){y||j()}));var T=function(e){if(e.preventDefault(),v&&"function"==typeof v){if(v(N)){if(A(),s)return s(N);o.parse(N)}}else{if(A(),s)return s(N);o.parse(N)}},A=function(){a((function(e){return S(S({},e),{messages:k(k([],e.messages,!0),[l(N,"user")],!1)})})),j(),x("")},B={backgroundColor:""};f&&f.chatButton&&(B.backgroundColor=f.chatButton.backgroundColor);var R="Conversation with "+d;m&&(R=m);var H="Write your message here";return h&&(H=h),n.default.createElement("div",{className:"react-chatbot-kit-chat-container"},n.default.createElement("div",{className:"react-chatbot-kit-chat-inner-container"},n.default.createElement(c.default,{condition:!!i.header,show:i.header&&i.header(u),elseShow:n.default.createElement("div",{className:"react-chatbot-kit-chat-header"},R)}),n.default.createElement("div",{className:"react-chatbot-kit-chat-message-container",ref:O},n.default.createElement(c.default,{condition:"string"==typeof b&&Boolean(b),show:n.default.createElement("div",{dangerouslySetInnerHTML:{__html:b}})}),C.map((function(e,o){return"bot"===e.type?n.default.createElement(n.default.Fragment,{key:e.id},function(e,o){var s;s=e.withAvatar?e.withAvatar:function(e,t){if(0===t)return!0;var a=e[t-1];return!("bot"===a.type&&!a.widget)}(C,o);var l=S(S({},e),{setState:a,state:t,customComponents:i,widgetRegistry:r,messages:C,actions:E});if(e.widget){var u=r.getWidget(l.widget,S(S({},t),{scrollIntoView:j,payload:e.payload,actions:E}));return n.default.createElement(n.default.Fragment,null,n.default.createElement(w,S({customStyles:f.botMessageBox,withAvatar:s},l,{key:e.id})),n.default.createElement(c.default,{condition:!l.loading,show:u||null}))}return n.default.createElement(w,S({customStyles:f.botMessageBox,key:e.id,withAvatar:s},l,{customComponents:i,messages:C,setState:a}))}(e,o)):"user"===e.type?n.default.createElement(n.default.Fragment,{key:e.id},function(e){var a=r.getWidget(e.widget,S(S({},t),{scrollIntoView:j,payload:e.payload,actions:E}));return n.default.createElement(n.default.Fragment,null,n.default.createElement(p,{message:e.message,key:e.id,customComponents:i}),a||null)}(e)):function(e,t){return!!t[e.type]}(e,g)?n.default.createElement(n.default.Fragment,{key:e.id},function(e){var o=g[e.type],s={setState:a,state:t,scrollIntoView:j,actionProvider:u,payload:e.payload,actions:E};if(e.widget){var c=r.getWidget(e.widget,S(S({},t),{scrollIntoView:j,payload:e.payload,actions:E}));return n.default.createElement(n.default.Fragment,null,o(s),c||null)}return o(s)}(e)):void 0})),n.default.createElement("div",{style:{paddingBottom:"15px"}})),n.default.createElement("div",{className:"react-chatbot-kit-chat-input-container"},n.default.createElement("form",{className:"react-chatbot-kit-chat-input-form",onSubmit:T},n.default.createElement("textarea",{className:"react-chatbot-kit-chat-input",placeholder:H,value:N,onChange:function(e){return x(e.target.value)},onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T(e))},rows:3}),n.default.createElement("button",{className:"react-chatbot-kit-chat-btn-send",style:B},n.default.createElement(P,{className:"react-chatbot-kit-chat-btn-send-icon"}))))))},C=function(e){var t=e.message;return n.default.createElement("div",{className:"react-chatbot-kit-error"},n.default.createElement("h1",{className:"react-chatbot-kit-error-header"},"Ooops. Something is missing."),n.default.createElement("div",{className:"react-chatbot-kit-error-container"},n.default.createElement(w,{message:t,withAvatar:!0,loading:!1,id:1,customStyles:{backgroundColor:""},messages:[]})),n.default.createElement("a",{href:"https://fredrikoseberg.github.io/react-chatbot-kit-docs/",rel:"noopener norefferer",target:"_blank",className:"react-chatbot-kit-error-docs"},"View the docs"))};var M=function(e){return e.widgets?e.widgets:[]},N=function(e){try{new e}catch(e){return!1}return!0},x=function(){return x=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},x.apply(this,arguments)};const j=function(e,t){var a=this;this.addWidget=function(e,t){var r=e.widgetName,n=e.widgetFunc,o=e.mapStateToProps,s=e.props;a[r]={widget:n,props:s,mapStateToProps:o,parentProps:x({},t)}},this.getWidget=function(e,t){var r=a[e];if(r){var n,o=x(x(x(x({scrollIntoView:t.scrollIntoView},r.parentProps),"object"==typeof(n=r.props)?n:{}),a.mapStateToProps(r.mapStateToProps,t)),{setState:a.setState,actionProvider:a.actionProvider||t.actions,actions:t.actions,state:t,payload:t.payload});return r.widget(o)||null}},this.mapStateToProps=function(e,t){if(e)return e.reduce((function(e,a){return e[a]=t[a],e}),{})},this.setState=e,this.actionProvider=t};var T=function(){return T=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},T.apply(this,arguments)},A=function(e,t,a){if(a||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))};const B=function(e){var t=e.config,a=e.actionProvider,r=e.messageParser,o=e.messageHistory,s=e.runInitialMessagesWithHistory,c=e.saveMessages,i=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a}(e,["config","actionProvider","messageParser","messageHistory","runInitialMessagesWithHistory","saveMessages"]),l="",m="";if(!t||!a||!r)return{configurationError:l="I think you forgot to feed me some props. Did you remember to pass a config, a messageparser and an actionprovider?"};var g=function(e,t){var a=[];return e.initialMessages||a.push("Config must contain property 'initialMessages', and it expects it to be an array of chatbotmessages."),a}(t);if(g.length)return{invalidPropsError:m=g.reduce((function(e,t){return e+t}),"")};var h=function(e){return e.state?e.state:{}}(t);o&&Array.isArray(o)?t.initialMessages=A([],o,!0):"string"==typeof o&&Boolean(o)&&(s||(t.initialMessages=[]));var p,v,y,b=n.default.useState(T({messages:A([],t.initialMessages,!0)},h)),w=b[0],E=b[1],P=n.default.useRef(w.messages),S=n.default.useRef(),k=n.default.useRef();(0,n.useEffect)((function(){P.current=w.messages})),(0,n.useEffect)((function(){o&&Array.isArray(o)&&E((function(e){return T(T({},e),{messages:o})}))}),[]),(0,n.useEffect)((function(){var e=k.current;return function(){if(c&&"function"==typeof c){var t=e.innerHTML.toString();c(P.current,t)}}}),[]),(0,n.useEffect)((function(){S.current=w}),[w]);var O=a,C=r;return N(O)&&N(C)?(p=new a(u,E,f,S.current,d,i),v=new j(E,p),y=new r(p,S.current),M(t).forEach((function(e){return null==v?void 0:v.addWidget(e,i)}))):(p=a,y=r,v=new j(E,null),M(t).forEach((function(e){return null==v?void 0:v.addWidget(e,i)}))),{widgetRegistry:v,actionProv:p,messagePars:y,configurationError:l,invalidPropsError:m,state:w,setState:E,messageContainerRef:k,ActionProvider:O,MessageParser:C}};var R=function(){return R=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},R.apply(this,arguments)};const H=function(e){var t=e.actionProvider,a=e.messageParser,r=e.config,o=e.headerText,s=e.placeholderText,c=e.saveMessages,i=e.messageHistory,l=e.runInitialMessagesWithHistory,d=e.disableScrollToBottom,f=e.validator,m=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a}(e,["actionProvider","messageParser","config","headerText","placeholderText","saveMessages","messageHistory","runInitialMessagesWithHistory","disableScrollToBottom","validator"]),g=B(R({config:r,actionProvider:t,messageParser:a,messageHistory:i,saveMessages:c,runInitialMessagesWithHistory:l},m)),h=g.configurationError,p=g.invalidPropsError,v=g.ActionProvider,y=g.MessageParser,b=g.widgetRegistry,w=g.messageContainerRef,E=g.actionProv,P=g.messagePars,S=g.state,k=g.setState;if(h)return n.default.createElement(C,{message:h});if(p.length)return n.default.createElement(C,{message:p});var M=function(e){return e.customStyles?e.customStyles:{}}(r),x=function(e){return e.customComponents?e.customComponents:{}}(r),j=function(e){return e.botName?e.botName:"Bot"}(r),T=function(e){return e.customMessages?e.customMessages:{}}(r);return N(v)&&N(y)?n.default.createElement(O,{state:S,setState:k,widgetRegistry:b,actionProvider:E,messageParser:P,customMessages:T,customComponents:R({},x),botName:j,customStyles:R({},M),headerText:o,placeholderText:s,validator:f,messageHistory:i,disableScrollToBottom:d,messageContainerRef:w}):n.default.createElement(v,{state:S,setState:k,createChatBotMessage:u},n.default.createElement(y,null,n.default.createElement(O,{state:S,setState:k,widgetRegistry:b,actionProvider:v,messageParser:y,customMessages:T,customComponents:R({},x),botName:j,customStyles:R({},M),headerText:o,placeholderText:s,validator:f,messageHistory:i,disableScrollToBottom:d,messageContainerRef:w})))},I=H;var W=r.bI,F=r.fU,V=r.RB,L=r.Zk,D=r.ZP,Z=r.dp;export{W as Chatbot,F as createChatBotMessage,V as createClientMessage,L as createCustomMessage,D as default,Z as useChatbot};